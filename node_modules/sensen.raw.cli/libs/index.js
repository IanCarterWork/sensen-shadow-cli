"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const Kernel = {
    Version: 1,
    VersionName: 'Raw CLI',
    VersionString: '0.0.1',
};
const $Console = {
    Parse(args, foreColor, bgColor) {
        const a = [];
        if (args.length) {
            for (let x = 0; x < args.length; x++) {
                if (typeof args[x] == 'string' && x === 0) {
                    a.push("\x1b[0m"), a.push(bgColor || ""), a.push(foreColor || "\x1b[37m");
                }
                a.push(args[x]);
                if (typeof args[x] == 'string' && x === 0) {
                    a.push("\x1b[0m");
                }
            }
            a.push("\x1b[0m");
        }
        return a;
    },
    Log(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[37m", "\x1b[40m"));
        return this;
    },
    Notice(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[37m", "\x1b[44m"));
        return this;
    },
    Success(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[37m", "\x1b[42m"));
        return this;
    },
    Warning(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[30m", "\x1b[43m"));
        return this;
    },
    Error(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[37m", "\x1b[41m"));
        return this;
    },
    Message(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[30m", "\x1b[47m"));
        return this;
    },
    Lite(...args) {
        console.log.apply(this, this.Parse(args || [], "\x1b[39m", ""));
        return this;
    },
};
class Create {
    /**
     * CLI Properties
     * @param { CliProps } props
     */
    constructor(props) {
        this.Props = props;
        this.Props.Children = this.Props.Children || [];
    }
    /**
     *
     * @param { string[] } args Tableau de chaines de caratères
     * @param { number } from Reduire le tableau à partir
     * @param { number } to Reduire le tableau jusqu'à
     * @returns { string[] }
     */
    static Args(args, from, to) {
        const out = [];
        from = from || 0;
        to = to || args.length;
        from = from < 1 ? 0 : from;
        to = to > args.length ? args.length : to;
        for (let x = (from); x < args.length; x++) {
            out.push(args[x]);
        }
        return out;
    }
    Add(child) {
        var _a;
        (_a = this.Props.Children) === null || _a === void 0 ? void 0 : _a.push(child);
        return this;
    }
    Find(args, children) {
        let found;
        if (Array.isArray(children || '')) {
            const iD = args[0];
            children.map(child => {
                var _a;
                if (iD == child.Props.iD) {
                    child.Props.Emit = (typeof child.Props.Emit == 'object') ? child.Props.Emit : {};
                    const arg = Create.Args(args, 1);
                    /** * Execution */
                    if (typeof child.Props.Execute == 'function') {
                        child.Emit('Begin', [arg]);
                        const cmd = child.Props.Execute(arg);
                        if (typeof cmd == 'string' || cmd instanceof child_process_1.ChildProcess) {
                            child.Emit('Stream', [arg, cmd]);
                            const stream = (0, child_process_1.exec)(`${cmd instanceof child_process_1.ChildProcess ? cmd.spawnargs : cmd}`, (err, stdout, stderr) => {
                                if (err) {
                                    console.log(`Error :\n`, stderr);
                                    child.Emit('Error', [arg]);
                                    return;
                                }
                                child.Emit('End', [arg]);
                                this.Find(arg, child.Props.Children || []);
                            });
                            (_a = stream.stdout) === null || _a === void 0 ? void 0 : _a.on('data', (chunk) => { console.log(chunk); });
                            return;
                        }
                        child.Emit('End', [arg]);
                        found = this.Find(arg, child.Props.Children || []) || child;
                    }
                    else {
                        if (child.Props.Children) {
                            found = this.Find(arg, child.Props.Children || []) || child;
                        }
                        else {
                            found = child;
                        }
                    }
                }
            });
        }
        return found;
    }
    Run(args) {
        $Console.Message(`Sensen ${Kernel.VersionName}, verion ${Kernel.Version}/${Kernel.VersionString}`, `$`, `${this.Props.iD} ${args.join(' ')}`);
        if (!this.Find(args, this.Props.Children || [])) {
            $Console.Notice(`Commands Helper`, `Command's Available`);
            if (typeof this.Props.Execute == 'function') {
                this.Props.Execute(Create.Args(args, 1));
            }
            this.Helper();
        }
        return this;
    }
    ChildHelper(iD, children) {
        if (children) {
            if (children.length) {
                children.map(child => {
                    $Console.Message(`$ ${iD ? `${iD} ` : ''}${child.Props.iD}`, `${child.Props.Title} ${(child.Props.About) ? `, ${child.Props.About}` : ''}`);
                    this.ChildHelper(`${iD ? `${iD} ` : ''}${child.Props.iD}`, child.Props.Children || []);
                });
            }
        }
        return this;
    }
    Helper() {
        this.ChildHelper(this.Props.iD, this.Props.Children || []);
        return this;
    }
}
class CliChildProcess {
    /**
     * CLI Properties
     * @param { CliProps } props
     */
    constructor(props) {
        this.Props = props;
    }
    Emit(emitter, args) {
        var _a;
        if (typeof this.Props.Emit == 'object') {
            if (typeof this.Props.Emit[emitter] == 'function') {
                (_a = this.Props.Emit[emitter]) === null || _a === void 0 ? void 0 : _a.apply(this, args);
            }
        }
        return this;
    }
}
const CliProps = {
    /**
     * @type { string }
     */
    iD: '',
    /**
     * @type { string }
     */
    Title: '',
    /**
     * @type { string }
     */
    About: '',
    /**
     * @type { Array<CliChildProcess> }
     */
    Children: [],
    /**
     * @type { (args: string[]) => ChildProcess | void }
     */
    Execute: (args => { }),
    /**
     *
     */
    Emit: {
        /**
         * @type { (args: string[]) => void }
         */
        Begin: (args => null),
        /**
         * @type { (args: string[]) => void }
         */
        Stream: ((args, stream) => null),
        /**
         * @type { (args: any) => void }
         */
        Error: (args => null),
        /**
         * @type { (args: string[]) => void }
         */
        End: (args => null),
    }
};
const SensenRawCli = {
    Props: CliProps,
    Create,
    Child: CliChildProcess,
    $Console,
};
exports.default = SensenRawCli;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9jb3JlL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsaURBQWtFO0FBc0NsRSxNQUFNLE1BQU0sR0FBRztJQUVYLE9BQU8sRUFBRSxDQUFDO0lBRVYsV0FBVyxFQUFFLFNBQVM7SUFFdEIsYUFBYSxFQUFFLE9BQU87Q0FFekIsQ0FBQTtBQU1ELE1BQU0sUUFBUSxHQUFHO0lBRWIsS0FBSyxDQUFDLElBQVcsRUFBRSxTQUFpQixFQUFFLE9BQWU7UUFFakQsTUFBTSxDQUFDLEdBQVUsRUFBRSxDQUFBO1FBRW5CLElBQUcsSUFBSSxDQUFDLE1BQU0sRUFBQztZQUVYLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUVsQyxJQUFHLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFDO29CQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksVUFBVSxDQUFDLENBQUM7aUJBQUU7Z0JBRXZILENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBRWYsSUFBRyxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQztvQkFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUFFO2FBRWxFO1lBRUQsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtTQUVwQjtRQUVELE9BQU8sQ0FBQyxDQUFBO0lBRVosQ0FBQztJQUVELEdBQUcsQ0FBQyxHQUFHLElB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RXhjZXB0aW9uIH0gZnJvbSBcImNoaWxkX3Byb2Nlc3NcIjtcblxuXG5cblxuZXhwb3J0IHR5cGUgVENsaUVtaXR0ZXIgPSB7XG5cbiAgICBCZWdpbj86IChhcmdzPzogc3RyaW5nW10pID0+IHZvaWQ7XG5cbiAgICBTdHJlYW0/OiAoYXJncz86IHN0cmluZ1tdLCBzdHJlYW0/OiBhbnkpID0+IHZvaWQ7XG5cbiAgICBFcnJvcj86IChhcmdzPzogYW55KSA9PiB2b2lkO1xuXG4gICAgRW5kPzogKGFyZ3M/OiBzdHJpbmdbXSkgPT4gdm9pZDtcbiAgICBcbn1cblxuXG5cblxuZXhwb3J0IGludGVyZmFjZSBUQ2xpUHJvcHN7XG5cbiAgICBpRDogc3RyaW5nO1xuICAgIFxuICAgIFRpdGxlOiBzdHJpbmc7XG4gICAgXG4gICAgQWJvdXQ/OiBzdHJpbmc7XG4gICAgXG4gICAgQ2hpbGRyZW4/OiBDbGlDaGlsZFByb2Nlc3NbXTtcblxuICAgIEV4ZWN1dGU6IChhcmdzOiBzdHJpbmdbXSkgPT4gQ2hpbGRQcm9jZXNzIHwgdm9pZDtcblxuICAgIEVtaXQ/OiBUQ2xpRW1pdHRlclxuICAgIFxufVxuXG5cblxuY29uc3QgS2VybmVsID0ge1xuXG4gICAgVmVyc2lvbjogMSxcblxuICAgIFZlcnNpb25OYW1lOiAnUmF3IENMSScsXG5cbiAgICBWZXJzaW9uU3RyaW5nOiAnMC4wLjEnLFxuICAgIFxufVxuXG5cblxuXG5cbmNvbnN0ICRDb25zb2xlID0ge1xuXG4gICAgUGFyc2UoYXJnczogYW55W10sIGZvcmVDb2xvcjogc3RyaW5nLCBiZ0NvbG9yOiBzdHJpbmcpe1xuXG4gICAgICAgIGNvbnN0IGE6IGFueVtdID0gW11cblxuICAgICAgICBpZihhcmdzLmxlbmd0aCl7XG5cbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgYXJncy5sZW5ndGg7IHgrKykge1xuXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGFyZ3NbeF0gPT0gJ3N0cmluZycgJiYgeCA9PT0gMCl7IGEucHVzaChcIlxceDFiWzBtXCIpLCBhLnB1c2goYmdDb2xvciB8fCBcIlwiKSwgYS5wdXNoKGZvcmVDb2xvciB8fCBcIlxceDFiWzM3bVwiKTsgfVxuXG4gICAgICAgICAgICAgICAgYS5wdXNoKGFyZ3NbeF0pXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGFyZ3NbeF0gPT0gJ3N0cmluZycgJiYgeCA9PT0gMCl7IGEucHVzaChcIlxceDFiWzBtXCIpOyB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYS5wdXNoKFwiXFx4MWJbMG1cIilcblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFcblxuICAgIH0sXG5cbiAgICBMb2coLi4uYXJnczogYW55W10pe1xuXG4gICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KHRoaXMsIHRoaXMuUGFyc2UoYXJnc3x8W10sIFwiXFx4MWJbMzdtXCIsIFwiXFx4MWJbNDBtXCIpKVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfSxcblxuICAgIE5vdGljZSguLi5hcmdzOiBhbnlbXSl7XG5cbiAgICAgICAgY29uc29sZS5sb2cuYXBwbHkodGhpcywgdGhpcy5QYXJzZShhcmdzfHxbXSwgXCJcXHgxYlszN21cIiwgXCJcXHgxYls0NG1cIikpXG4gICAgICAgICAgIFxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgIH0sXG5cbiAgICBTdWNjZXNzKC4uLmFyZ3M6IGFueVtdKXtcblxuICAgICAgICBjb25zb2xlLmxvZy5hcHBseSh0aGlzLCB0aGlzLlBhcnNlKGFyZ3N8fFtdLCBcIlxceDFiWzM3bVwiLCBcIlxceDFiWzQybVwiKSlcbiAgICAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfSxcblxuICAgIFdhcm5pbmcoLi4uYXJnczogYW55W10pe1xuXG4gICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KHRoaXMsIHRoaXMuUGFyc2UoYXJnc3x8W10sIFwiXFx4MWJbMzBtXCIsIFwiXFx4MWJbNDNtXCIpKVxuICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICB9LFxuXG4gICAgRXJyb3IoLi4uYXJnczogYW55W10pe1xuXG4gICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KHRoaXMsIHRoaXMuUGFyc2UoYXJnc3x8W10sIFwiXFx4MWJbMzdtXCIsIFwiXFx4MWJbNDFtXCIpKVxuICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICB9LFxuXG4gICAgTWVzc2FnZSguLi5hcmdzOiBhbnlbXSl7XG5cbiAgICAgICAgY29uc29sZS5sb2cuYXBwbHkodGhpcywgdGhpcy5QYXJzZShhcmdzfHxbXSwgXCJcXHgxYlszMG1cIiwgXCJcXHgxYls0N21cIikpXG4gICAgICAgICAgIFxuICAgICAgICByZXR1cm4gdGhpcztcblxuICAgIH0sXG5cbiAgICBMaXRlKC4uLmFyZ3M6IGFueVtdKXtcblxuICAgICAgICBjb25zb2xlLmxvZy5hcHBseSh0aGlzLCB0aGlzLlBhcnNlKGFyZ3N8fFtdLCBcIlxceDFiWzM5bVwiLCBcIlwiKSlcbiAgICAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfSxcblxuICAgIFxufVxuXG5cblxuXG5cbmNsYXNzIENyZWF0ZXtcblxuICAgIFByb3BzOiBUQ2xpUHJvcHNcblxuICAgIC8qKlxuICAgICAqIENMSSBQcm9wZXJ0aWVzXG4gICAgICogQHBhcmFtIHsgQ2xpUHJvcHMgfSBwcm9wcyBcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVENsaVByb3BzKXtcblxuICAgICAgICB0aGlzLlByb3BzID0gcHJvcHM7XG5cbiAgICAgICAgdGhpcy5Qcm9wcy5DaGlsZHJlbiA9IHRoaXMuUHJvcHMuQ2hpbGRyZW4gfHwgW107XG5cbiAgICB9XG5cblxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHsgc3RyaW5nW10gfSBhcmdzIFRhYmxlYXUgZGUgY2hhaW5lcyBkZSBjYXJhdMOocmVzXG4gICAgICogQHBhcmFtIHsgbnVtYmVyIH0gZnJvbSBSZWR1aXJlIGxlIHRhYmxlYXUgw6AgcGFydGlyXG4gICAgICogQHBhcmFtIHsgbnVtYmVyIH0gdG8gUmVkdWlyZSBsZSB0YWJsZWF1IGp1c3F1J8OgXG4gICAgICogQHJldHVybnMgeyBzdHJpbmdbXSB9XG4gICAgICovXG4gICAgc3RhdGljIEFyZ3MoYXJnczogc3RyaW5nW10sIGZyb20/OiBudW1iZXIsIHRvPzogbnVtYmVyKXtcblxuICAgICAgICBjb25zdCBvdXQgOiBzdHJpbmdbXSA9IFtdXG5cbiAgICAgICAgZnJvbSA9IGZyb20gfHwgMDtcbiAgICAgICAgXG4gICAgICAgIHRvID0gdG8gfHwgYXJncy5sZW5ndGg7XG5cblxuICAgICAgICBmcm9tID0gZnJvbSA8IDEgPyAwIDogZnJvbTtcblxuICAgICAgICB0byA9IHRvID4gYXJncy5sZW5ndGggPyBhcmdzLmxlbmd0aCA6IHRvO1xuXG5cbiAgICAgICAgZm9yIChsZXQgeCA9IChmcm9tKTsgeCA8IGFyZ3MubGVuZ3RoOyB4KyspIHsgb3V0LnB1c2goIGFyZ3NbeF0gKTsgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuXG5cbiAgICBBZGQoY2hpbGQ6IENsaUNoaWxkUHJvY2Vzcyl7XG5cbiAgICAgICAgdGhpcy5Qcm9wcy5DaGlsZHJlbj8ucHVzaCggY2hpbGQgKVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfVxuICAgIFxuXG5cblxuICAgIEZpbmQoYXJnczogc3RyaW5nW10sIGNoaWxkcmVuOiBDbGlDaGlsZFByb2Nlc3NbXSl7XG5cbiAgICAgICAgbGV0IGZvdW5kIDogQ2xpQ2hpbGRQcm9jZXNzIHwgdW5kZWZpbmVkO1xuXG5cbiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShjaGlsZHJlbnx8JycpKXtcblxuICAgICAgICAgICAgY29uc3QgaUQgPSBhcmdzWzBdXG5cbiAgICAgICAgICAgIGNoaWxkcmVuLm1hcChjaGlsZD0+e1xuXG4gICAgICAgICAgICAgICAgaWYoaUQgPT0gY2hpbGQuUHJvcHMuaUQpe1xuXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLlByb3BzLkVtaXQgPSAodHlwZW9mIGNoaWxkLlByb3BzLkVtaXQgPT0gJ29iamVjdCcpID8gY2hpbGQuUHJvcHMuRW1pdCA6IHt9O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFyZyA9IENyZWF0ZS5BcmdzKGFyZ3MsIDEpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqICogRXhlY3V0aW9uICovXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjaGlsZC5Qcm9wcy5FeGVjdXRlID09ICdmdW5jdGlvbicpe1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLkVtaXQoJ0JlZ2luJywgW2FyZ10pXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY21kID0gY2hpbGQuUHJvcHMuRXhlY3V0ZSggYXJnIClcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGNtZCA9PSAnc3RyaW5nJyB8fCBjbWQgaW5zdGFuY2VvZiBDaGlsZFByb2Nlc3Mpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuRW1pdCgnU3RyZWFtJywgW2FyZywgY21kXSlcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0gZXhlYyhgJHsgY21kIGluc3RhbmNlb2YgQ2hpbGRQcm9jZXNzID8gY21kLnNwYXduYXJncyA6IGNtZCB9YCwgKGVycjogRXhlY0V4Y2VwdGlvbiB8IG51bGwsIHN0ZG91dDogc3RyaW5nLCBzdGRlcnI6IHN0cmluZyk9PntcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihlcnIpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3IgOlxcbmAsIHN0ZGVycilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQuRW1pdCgnRXJyb3InLCBbYXJnXSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5FbWl0KCdFbmQnLCBbYXJnXSlcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuRmluZChhcmcsIGNoaWxkLlByb3BzLkNoaWxkcmVufHxbXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uc3Rkb3V0Py5vbignZGF0YScsIChjaHVuayk9PnsgY29uc29sZS5sb2coY2h1bmspOyB9KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5FbWl0KCdFbmQnLCBbYXJnXSlcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRoaXMuRmluZChhcmcsIGNoaWxkLlByb3BzLkNoaWxkcmVufHxbXSkgfHwgY2hpbGQ7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgZWxzZXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2hpbGQuUHJvcHMuQ2hpbGRyZW4pe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0aGlzLkZpbmQoYXJnLCBjaGlsZC5Qcm9wcy5DaGlsZHJlbnx8W10pIHx8IGNoaWxkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IGNoaWxkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG5cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIFxuXG4gICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIFxuXG5cbiAgICBSdW4oYXJnczogc3RyaW5nW10pe1xuXG4gICAgICAgICRDb25zb2xlLk1lc3NhZ2UoYFNlbnNlbiAkeyBLZXJuZWwuVmVyc2lvbk5hbWUgfSwgdmVyaW9uICR7IEtlcm5lbC5WZXJzaW9uIH0vJHsgS2VybmVsLlZlcnNpb25TdHJpbmcgfWAsIGAkYCwgYCR7IHRoaXMuUHJvcHMuaUQgfSAkeyBhcmdzLmpvaW4oJyAnKSB9YClcblxuICAgICAgICBpZighdGhpcy5GaW5kKGFyZ3MsIHRoaXMuUHJvcHMuQ2hpbGRyZW4gfHwgW10pKXtcblxuICAgICAgICAgICAgJENvbnNvbGUuTm90aWNlKGBDb21tYW5kcyBIZWxwZXJgLCBgQ29tbWFuZCdzIEF2YWlsYWJsZWApXG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLlByb3BzLkV4ZWN1dGUgPT0gJ2Z1bmN0aW9uJyl7XG5cbiAgICAgICAgICAgICAgICB0aGlzLlByb3BzLkV4ZWN1dGUoIENyZWF0ZS5BcmdzKGFyZ3MsIDEpIClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5IZWxwZXIoKVxuXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfVxuXG5cblxuXG4gICAgQ2hpbGRIZWxwZXIoaUQ6IHN0cmluZyB8IG51bGwsIGNoaWxkcmVuOiBDbGlDaGlsZFByb2Nlc3NbXSl7XG5cbiAgICAgICAgaWYoIGNoaWxkcmVuICl7XG5cbiAgICAgICAgICAgIGlmKCBjaGlsZHJlbi5sZW5ndGggKXtcblxuICAgICAgICAgICAgICAgIGNoaWxkcmVuLm1hcChjaGlsZD0+e1xuXG4gICAgICAgICAgICAgICAgICAgICRDb25zb2xlLk1lc3NhZ2UoYCQgJHsgaUQgPyBgJHsgaUQgfSBgIDogJycgfSR7IGNoaWxkLlByb3BzLmlEIH1gLCBgJHsgY2hpbGQuUHJvcHMuVGl0bGUgfSAkeyAoY2hpbGQuUHJvcHMuQWJvdXQpID8gYCwgJHsgY2hpbGQuUHJvcHMuQWJvdXQgfWAgOiAnJyB9YClcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLkNoaWxkSGVscGVyKGAkeyBpRCA/IGAkeyBpRCB9IGAgOiAnJyB9JHsgY2hpbGQuUHJvcHMuaUQgfWAsIGNoaWxkLlByb3BzLkNoaWxkcmVuIHx8IFtdKVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIFxuXG5cbiAgICBIZWxwZXIoKXtcblxuICAgICAgICB0aGlzLkNoaWxkSGVscGVyKHRoaXMuUHJvcHMuaUQsIHRoaXMuUHJvcHMuQ2hpbGRyZW4gfHwgW10gKVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgXG4gICAgXG4gICAgXG59XG5cblxuXG5cbmNsYXNzIENsaUNoaWxkUHJvY2Vzc3tcblxuICAgIFByb3BzOiBUQ2xpUHJvcHNcblxuICAgIC8qKlxuICAgICAqIENMSSBQcm9wZXJ0aWVzXG4gICAgICogQHBhcmFtIHsgQ2xpUHJvcHMgfSBwcm9wcyBcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVENsaVByb3BzKXtcblxuICAgICAgICB0aGlzLlByb3BzID0gcHJvcHM7XG4gICAgICAgIFxuICAgIH1cblxuXG4gICAgRW1pdChlbWl0dGVyOiBrZXlvZiBUQ2xpRW1pdHRlciwgYXJncz86IGFueSApe1xuXG4gICAgICAgIGlmKHR5cGVvZiB0aGlzLlByb3BzLkVtaXQgPT0gJ29iamVjdCcpeyBcblxuICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMuUHJvcHMuRW1pdFtlbWl0dGVyXSA9PSAnZnVuY3Rpb24nKXsgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5Qcm9wcy5FbWl0W2VtaXR0ZXJdPy5hcHBseSh0aGlzLCBhcmdzICk7IFxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfVxuICAgIFxuICAgIFxufVxuXG5cblxuXG5jb25zdCBDbGlQcm9wcyA6IFRDbGlQcm9wcyA9IHtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHsgc3RyaW5nIH1cbiAgICAgKi9cbiAgICBpRDogJycsXG4gICAgXG4gICAgLyoqXG4gICAgICogQHR5cGUgeyBzdHJpbmcgfVxuICAgICAqL1xuICAgIFRpdGxlOiAnJyxcbiAgICBcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7IHN0cmluZyB9XG4gICAgICovXG4gICAgQWJvdXQ6ICcnLFxuICAgIFxuICAgIC8qKlxuICAgICAqIEB0eXBlIHsgQXJyYXk8Q2xpQ2hpbGRQcm9jZXNzPiB9XG4gICAgICovXG4gICAgQ2hpbGRyZW46IFtdLFxuICAgIFxuICAgIC8qKlxuICAgICAqIEB0eXBlIHsgKGFyZ3M6IHN0cmluZ1tdKSA9PiBDaGlsZFByb2Nlc3MgfCB2b2lkIH1cbiAgICAgKi9cbiAgICBFeGVjdXRlOiAoYXJncz0+e30pLFxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICovXG4gICAgRW1pdDoge1xuICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUgeyAoYXJnczogc3RyaW5nW10pID0+IHZvaWQgfVxuICAgICAgICAgKi9cbiAgICAgICAgQmVnaW46IChhcmdzPT5udWxsKSxcbiAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB0eXBlIHsgKGFyZ3M6IHN0cmluZ1tdKSA9PiB2b2lkIH1cbiAgICAgICAgICovXG4gICAgICAgIFN0cmVhbTogKChhcmdzLCBzdHJlYW0pPT5udWxsKSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQHR5cGUgeyAoYXJnczogYW55KSA9PiB2b2lkIH1cbiAgICAgICAgICovXG4gICAgICAgIEVycm9yOiAoYXJncz0+bnVsbCksXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB0eXBlIHsgKGFyZ3M6IHN0cmluZ1tdKSA9PiB2b2lkIH1cbiAgICAgICAgICovXG4gICAgICAgIEVuZDogKGFyZ3M9Pm51bGwpLFxuICAgICAgICBcbiAgICB9XG4gICAgXG5cbn1cblxuXG5cblxuY29uc3QgU2Vuc2VuUmF3Q2xpID0ge1xuICAgIFxuICAgIFByb3BzOiBDbGlQcm9wcyxcbiAgICBcbiAgICBDcmVhdGUsXG5cbiAgICBDaGlsZDogQ2xpQ2hpbGRQcm9jZXNzLFxuXG4gICAgJENvbnNvbGUsXG5cbn1cblxuXG5cbmV4cG9ydCBkZWZhdWx0IFNlbnNlblJhd0NsaSJdfQ==